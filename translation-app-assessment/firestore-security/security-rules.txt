// Copyright 2020 Google LLC. This software is provided as-is, without warranty
// or representation for any use or purpose. Your use of it is subject to your
// agreement with Google.

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /externalusers/{externaluser} {
      allow read, write: if request.auth != null;
    }
    match /chats/{chat} {
    	// For guests, only allow reading and creating chats where the guestId is their uid
      // and only if not expired
      allow read, create: if resource.data.guestId == request.auth.uid && request.time.toMillis() < resource.data.expiryDate;
    }
  }
}